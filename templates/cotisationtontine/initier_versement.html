{% extends "base.html" %}
{% block title %}Effectuer un versement{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Effectuer un versement pour {{ member.nom }}</h2>

  <form method="post" id="versement-form">
    {% csrf_token %}

    <!-- Champ montant -->
    <div class="mb-3">
      <label for="montant" class="form-label">Montant Ã  verser (FCFA)</label>
      <input type="number" class="form-control" name="montant" id="montant" min="1" required>
    </div>

    <!-- Champ mÃ©thode de paiement -->
    <div class="mb-3">
      <label for="methode" class="form-label">MÃ©thode de paiement</label>
      <select name="methode" id="methode" class="form-select" required>
        <option value="paydunya">PayDunya</option>
        <option value="caisse">Caisse (sans frais)</option>
      </select>
    </div>

    <!-- Infos frais -->
    <div class="mb-3" id="frais-section">
      <p class="mb-1">ðŸ§¾ <strong>Frais :</strong> <span id="frais">0</span> FCFA</p>
      <p class="mb-1">ðŸ’³ <strong>Total Ã  payer :</strong> <span id="total">0</span> FCFA</p>
    </div>

    <!-- Boutons -->
    <button type="submit" class="btn btn-success" id="submit-btn">ðŸ’³ Payer avec PayDunya</button>
    <a href="{% url 'cotisationtontine:dashboard_tontine_simple' %}" class="btn btn-secondary">Annuler</a>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const montantInput = document.getElementById('montant');
  const methodeSelect = document.getElementById('methode');
  const fraisEl = document.getElementById('frais');
  const totalEl = document.getElementById('total');
  const fraisSection = document.getElementById('frais-section');
  const submitBtn = document.getElementById('submit-btn');

  function updateFrais() {
    let montant = parseFloat(montantInput.value) || 0;
    let methode = methodeSelect.value;

    if (methode === 'paydunya') {
      let fraisPourcent = montant * 0.02;
      let fraisFixe = 50;
      let fraisTotal = fraisPourcent + fraisFixe;
      let total = montant + fraisTotal;

      fraisEl.textContent = fraisTotal.toFixed(0);
      totalEl.textContent = total.toFixed(0);
      fraisSection.style.display = 'block';
      submitBtn.textContent = 'ðŸ’³ Payer avec PayDunya';

    } else {
      // Mode "Caisse"
      fraisSection.style.display = 'none';
      submitBtn.textContent = 'âœ… Enregistrer le versement';
    }
  }

  montantInput.addEventListener('input', updateFrais);
  methodeSelect.addEventListener('change', updateFrais);

  updateFrais(); // Initialiser au chargement
});
</script>
{% endblock %}
