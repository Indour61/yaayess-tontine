{% extends 'base.html' %}

{% block title %}Historique des cycles â€“ {{ group.nom }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>ðŸ“œ Historique des cycles â€“ {{ group.nom }}</h2>

  {% if anciens_cycles %}
    <div class="accordion mt-4" id="cyclesAccordion">
      {% for cycle in anciens_cycles %}
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading{{ forloop.counter }}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}">
              Cycle du {{ cycle.date_debut|date:"d/m/Y" }} au {{ cycle.date_fin|default:"â€”" }}
            </button>
          </h2>
          <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" data-bs-parent="#cyclesAccordion">
            <div class="accordion-body">

              {% if cycle.etapes.all %}
                <ul class="list-group">
                  {% for etape in cycle.etapes.all %}
                    <li class="list-group-item">
                      <strong>Ã‰tape {{ etape.numero_etape }}</strong> â€” {{ etape.date_etape|date:"d/m/Y" }}
                      {% if etape.tirage %}
                        <br>ðŸŽ¯ <strong>BÃ©nÃ©ficiaire :</strong> {{ etape.tirage.beneficiaire.user.nom }} â€” <strong>{{ etape.tirage.montant_total }} FCFA</strong>
                      {% else %}
                        <br><em>Tirage non effectuÃ©</em>
                      {% endif %}
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <p class="text-muted mt-2">Aucune Ã©tape enregistrÃ©e pour ce cycle.</p>
              {% endif %}

            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">Aucun cycle archivÃ©.</p>
  {% endif %}
</div>
{% endblock %}
