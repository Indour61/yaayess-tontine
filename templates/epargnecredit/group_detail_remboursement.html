{% extends "base.html" %}
{% load humanize %}
{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mt-4">

  <!-- Navigation -->
  <div class="d-flex gap-2 mb-3">
    <a href="{% url 'epargnecredit:group_list' %}" class="btn btn-outline-secondary">
      â¬…ï¸ Retour Ã  la liste des groupes
    </a>
    {% if group.parent_group %}
      <a href="{% url 'epargnecredit:group_detail' group.parent_group.id %}" class="btn btn-outline-primary">
        â†©ï¸ Retour au groupe parent
      </a>
    {% endif %}
  </div>

  <h2 class="mb-1">{{ group.nom }}</h2>
  <p class="text-muted">
    Groupe de remboursement liÃ© Ã  :
    <strong>{{ group.parent_group.nom }}</strong>
  </p>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags|default:'info' }}">{{ message|safe }}</div>
    {% endfor %}
  {% endif %}

  <div class="alert alert-secondary small">
    ğŸ” Pas dâ€™objectif fixe : les versements sont <strong>toujours possibles</strong>.
  </div>

  <div class="card">
    <div class="card-header">Membres Ã  rembourser</div>
    <div class="card-body p-0">
      <table class="table mb-0 align-middle">
        <thead>
          <tr>
            <th>Nom</th>
            <th class="text-end">Actions</th>
            <th class="text-end">Montant versÃ©</th>
            <th class="text-end">Montant prÃªtÃ© + intÃ©rÃªt</th>
            <th class="text-end">Mensuel Ã  rembourser</th>
            <th class="text-end">PÃ©nalitÃ©s</th>
            <th class="text-end">Reste Ã  rembourser</th>
          </tr>
        </thead>
        <tbody>
        {% for m in membres %}
          <tr>
            <td>
              {% if m.user.nom %}
                {{ m.user.nom|title }}
              {% else %}
                {{ m.user.phone|default:"â€”" }}
              {% endif %}
            </td>

            <td class="text-end">
              <a href="{% url 'epargnecredit:initier_paiement_remboursement' m.id %}"
                 class="btn btn-sm btn-success">
                ğŸ’° Verser
              </a>
            </td>

            <td class="text-end">
              {{ m.total_verse|default_if_none:0|floatformat:0|intcomma }} FCFA
            </td>

            <td class="text-end">
              {% if m.montant_prete_plus_interet is not None %}
                {{ m.montant_prete_plus_interet|floatformat:0|intcomma }} FCFA
              {% else %} â€” {% endif %}
            </td>

            <td class="text-end">
              {% if m.mensualite is not None %}
                {{ m.mensualite|floatformat:0|intcomma }} FCFA
              {% else %} â€” {% endif %}
            </td>

            <td class="text-end">
              {% if m.penalites is not None %}
                {{ m.penalites|floatformat:0|intcomma }} FCFA
              {% else %} â€” {% endif %}
            </td>

            <td class="text-end">
              {% if m.reste_a_rembourser is not None %}
                {{ m.reste_a_rembourser|floatformat:0|intcomma }} FCFA
              {% else %} â€” {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="7" class="text-center text-muted py-3">
              Aucun membre Ã  rembourser pour le moment.
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

